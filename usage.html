<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-10-15 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Maven Protocol Buffers Plugin &#x2013; Usage</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Maven Protocol Buffers Plugin
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-10-15</span>
                  &nbsp;| <span id="projectVersion">Version: 0.5.1</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/google/protobuf" class="externalLink" title="Google Protocol Buffers">Google Protocol Buffers</a>
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="plugin-info.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
            <strong>Usage</strong>
          </li>
                  <li class="none">
                          <a href="faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                       <h5>Examples</h5>
                  <ul>
                  <li class="none">
                          <a href="examples/protobuf-toolchain.html" title="Protobuf Toolchain">Protobuf Toolchain</a>
            </li>
                  <li class="none">
                          <a href="examples/protoc-artifact.html" title="Protoc Artifact">Protoc Artifact</a>
            </li>
                  <li class="none">
                          <a href="examples/protoc-plugin.html" title="Custom Protoc Plugins">Custom Protoc Plugins</a>
            </li>
          </ul>
                       <h5>Community</h5>
                  <ul>
                  <li class="none">
                          <a href="contributions.html" title="How to Contribute">How to Contribute</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>Maven Protocol Buffers Plugin generates Java, C++ or Python sources from <tt>.proto</tt> files using the <tt>protoc</tt> tool. The following examples describe the basic usage of the Plugin.</p>
<div class="section">
<h3><a name="Compiling_Protobuf_Sources_into_Java"></a>Compiling Protobuf Sources into Java</h3>
<p>The following default directory structure of the project is assumed:</p>
<div class="source">
<pre>
./
+- pom.xml
+- src/
   +- main/
      +- proto/
         +- message.proto
   +- test/
      +- proto/
         +- test_message.proto

</pre></div>
<p>Protocol buffer definitions are looked up under <tt>src/main/proto/</tt> directory by default. Any subdirectories under <tt>src/main/proto/</tt> are treated as package structure for protobuf definition imports. Similarly, protobuf definitions for use in tests are looked up under <tt>src/test/proto/</tt> directory by default.</p>
<p>A minimal configuration to invoke this plugin would look like:</p>
<div class="source">
<pre>
&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.7.0&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.6&lt;/source&gt;
          &lt;target&gt;1.6&lt;/target&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;0.5.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;protocExecutable&gt;/usr/local/bin/protoc&lt;/protocExecutable&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compile&lt;/goal&gt;
              &lt;goal&gt;test-compile&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
  &lt;/build&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
      &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
      &lt;version&gt;3.4.0&lt;/version&gt;
    &lt;/dependency&gt;
    ...
  &lt;/dependencies&gt;
  ...
&lt;/project&gt;

</pre></div>
<p>The following conditions need to be met:</p>
<ul>
<li>Java 1.5 or newer is required due to the usage of Generics</li>
<li>Java 1.6 or newer is required for running custom Java plugins for protobuf compiler</li>
<li>Java 1.7 or newer is recommended</li>
<li>Either <tt>protoc</tt> executable has to be in the <tt>PATH</tt> or the <tt>protocExecutable</tt> parameter has to be set to the correct location. An alternative configuration involves toolchains (described in plugin examples).</li>
<li>Plugin executions need to be defined, because the plugin is not part of the default lifecycle. However, plugin goals have default bindings to appropriate phases, therefore there is typically no need to specify phase bindings in plugin configuration.<br />Note: <tt><a href="./test-compile-mojo.html">test-compile</a></tt> goal will only be needed if there are custom protocol buffer definitions being used in your tests.</li>
<li>An appropriate version of <tt>com.google.protobuf:protobuf-java</tt> dependency has to be declared, or made available through POM inheritance: this is needed for compiling the generated source code. Note: it is important to make sure that the version of protobuf compiler is compatible with the version of protobuf java library (ideally they should be of the same version), otherwise the generated code will fail to compile.</li></ul>
<p>As soon as everything is set up, execute the following goals to build the project:</p>
<div class="source">
<pre>
mvn clean install

</pre></div></div>
<div class="section">
<h3><a name="Compiling_Protobuf_Sources_into_C_or_Python"></a>Compiling Protobuf Sources into C++ or Python</h3>
<p>The plugin configuration is similar to compiling into Java, with the following alterations:</p>
<ul>
<li>A different set of goals will need to be used (e.g. <a href="./compile-cpp-mojo.html">compile-cpp</a>);</li>
<li>A dependency on <tt>com.google.protobuf:protobuf-java</tt> artifact may not be required.</li></ul></div>
<div class="section">
<h3><a name="Running_Plugin_Goals_On_Command_Line"></a>Running Plugin Goals On Command Line</h3>
<p>It is possible to run Maven Protocol Buffers Plugin goals from the command line, even if the plugin is not configured in the project:</p>
<div class="source">
<pre>
mvn protobuf:compile      -DprotocExecutable=&quot;C:/Java/protobuf-2.4.1/bin/protoc.exe&quot;
mvn protobuf:test-compile -DprotocExecutable=&quot;C:/Java/protobuf-2.4.1/bin/protoc.exe&quot;

</pre></div>
<p>If a <tt>protobuf</tt> toolchain is configured in the project, then the toolchains plugin needs to be executed first and there is no need to specify the <tt>protocExecutable</tt> parameter.</p>
<div class="source">
<pre>
mvn toolchains:toolchain protobuf:compile
mvn toolchains:toolchain protobuf:test-compile

</pre></div></div>
<div class="section">
<h3><a name="Suppressing_Compilation_Of_Unchanged_Definitions"></a>Suppressing Compilation Of Unchanged Definitions</h3>
<p>Normally this plug-in invokes <tt>protoc</tt> compilation on every execution, but this can be overridden by the following configuration option:</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.5.1&lt;/version&gt;
  &lt;configuration&gt;
    ...
    &lt;checkStaleness&gt;true&lt;/checkStaleness&gt;
  &lt;/configuration&gt;
  ...
&lt;/plugin&gt;

</pre></div>
<p>If the project is built on NFS, the following setting may also be needed:</p>
<div class="source">
<pre>
&lt;plugin&gt;
  &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.5.1&lt;/version&gt;
  &lt;configuration&gt;
    ...
    &lt;checkStaleness&gt;true&lt;/checkStaleness&gt;
    &lt;staleMillis&gt;10000&lt;/staleMillis&gt;
  &lt;/configuration&gt;
  ...
&lt;/plugin&gt;

</pre></div></div>
<div class="section">
<h3><a name="Output_Of_Binary_File_Descriptor_Sets"></a>Output Of Binary File Descriptor Sets</h3>
<p>It is possible to output binary <tt>FileDescriptorSet</tt> files containing all the descriptor metadata for generated classes. Descriptor sets are written by passing the <tt>--descriptor_set_out</tt> and <tt>--include_imports</tt> arguments to <tt>protoc</tt>.</p>
<p>Generated descriptor sets can optionally be attached to the build as artifacts. The default type and extension for descriptor sets is <tt>protobin</tt>, and the plugin extensions need to be enabled in order to support the correct resolution of those dependencies in downstream projects.</p>
<p>The following plugin options configure descriptor set output:</p>
<ul>
<li><tt>writeDescriptorSet</tt> - determines if a descriptor set is written; default is <tt>false</tt>.</li>
<li><tt>includeDependenciesInDescriptorSet</tt> - if <tt>true</tt>, all imports are included in the descriptor set; default is <tt>false</tt>.</li>
<li><tt>includeSourceInfoInDescriptorSet</tt> - if <tt>true</tt>, source code information will be included in the descriptor set; default is <tt>false</tt>. Please note that the size of the description set may increase significantly if this option is enabled.</li>
<li><tt>descriptorSetFileName</tt> - the file name of the descriptor set; default is the artifact name with the <tt>.protobin</tt> extension.</li>
<li><tt>descriptorSetOutputDirectory</tt> - the directory where the descriptor set file will be created</li>
<li><tt>attachDescriptorSet</tt> - attach the generated descriptor set as an artifact to the build</li>
<li><tt>descriptorSetClassifier</tt> - an optional artifact classifier for the attached descriptor</li></ul></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2016&#x2013;2017
                        <a href="https://github.com/xolstice/protobuf-maven-plugin/blob/master/AUTHORS">Maven Protocol Buffers Plugin Authors</a>.
            All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
